<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta charset="UTF-8" />
    <meta property="og:title" content="" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/docsify/lib/themes/dark.min.css"
    />

    <!-- giscus -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/docsify-giscus/dist/giscus.min.css"
    />
    <style>
      .giscus {
        width: 100% !important;
        padding: 5px;
        min-height: 200px;
      }
      .giscus iframe {
        width: 100% !important;
        border: 0;
        min-height: 200px;
      }
    </style>
  </head>
  <body>
    <nav>
      <a href="/">Home</a>
      <a href="https://hackintosh.club">Hackintosh.Club</a>
    </nav>
    <div id="app">Please wait...</div>
    <script>
      const CDN = "https://cdn.jsdelivr.net/gh/hackintosh-club";
      window.$docsify = {
        repo: "https://github.com/hackintosh-club",
        name: "<strong>Hackintosh EFI</strong>",
        onlyCover: true,
        coverpage: true,
        loadSidebar: true,
        autoHeader: true,
        nativeEmoji: true,
        // routerMode: "history",
        themeColor: "#F36322",
        alias: {
          "/r/_sidebar.md": "/_sidebar.md",
          "/r/(.*)": CDN + "/$1/README.md",
        },

        // plugins
        // baiduTongjiID
        // baiduTongjiID: "xxxxxxx",
        // giscus
        giscus: {
          repo: "hackintosh-club/efihub.comment",
          repoId: "R_kgDOLu2oNQ",
          category: "Comment",
          categoryId: "DIC_kwDOLu2oNc4CeuI7",
          mapping: "og:title",
          reactionsEnabled: "1",
          strict: "1",
          emitMetadata: "0",
          inputPosition: "top",
          theme: "transparent_dark",
          lang: "en",
          loading: "lazy",
        },
      };

      (function () {
        const xid = function (vm) {
          const _xid = vm.route.path.replace("/r/", "").toLowerCase();
          console.log("xid", _xid);
          return _xid;
        };
        const allowRoute = function (vm) {
          return vm.route.path.startsWith("/r");
        };
        const baseURL = function (vm) {
          const _url = CDN + vm.route.path.replace("/r", "") + "/";
          console.log("baseURL", _url);
          return _url;
        };

        var contentPlugin = function (hook, vm) {
          hook.beforeEach(function (markdown) {
            console.log("hook.beforeEach");
            if (!allowRoute(vm)) {
              return markdown;
            }

            // Replace image src attributes
            markdown = markdown.replace(
              /!\[.*?\]\((?!http)(.*?)\)/g,
              (match, p1) => {
                return `![${match
                  .match(/\!\[.*?\]/)[0]
                  .slice(2, -1)}](${baseURL(vm)}${p1})`;
              }
            );

            // delete README
            markdown = markdown.replace(
              /(#+)\s*\[.*?\]\(README.*?\.md\)\s*$/gm,
              ""
            );

            return markdown;
          });
        };

        var baiduTongjiPlugin = function (hook, vm) {
          hook.mounted(function () {
            if (!vm.config.baiduTongjiID) {
              console.warn("baiduTongjiID not config");
              return;
            }
            const id = vm.config.baiduTongjiID;
            var hm = document.createElement("script");
            hm.src = "https://hm.baidu.com/hm.js?" + id;
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
            console.info(id);
            console.info("baiduTongjiPlugin init success!");
          });
        };

        var giscusPlugin = function (hook, vm) {
          hook.beforeEach(function (markdown) {
            console.log("hook.beforeEach");
            if (!allowRoute(vm)) {
              return markdown;
            }

            document
              .querySelector("meta[property='og:title']")
              .setAttribute("content", xid(vm));
            return markdown;
          });

          hook.afterEach(function (html) {
            console.log("hook.afterEach");
            if (!vm.route.path.startsWith("/r")) {
              return html;
            }

            document.querySelector("#giscus") &&
              document.querySelector("#giscus").remove();

            var giscus = document.createElement("script");
            giscus.id = "giscus";
            giscus.src = "https://giscus.app/client.js";
            giscus.crossorigin = "anonymous";
            giscus.async = true;
            for (const key in vm.config.giscus) {
              giscus.dataset[key] = vm.config.giscus[key];
            }
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(giscus, s);
            console.info("render giscus done");
            return html + "<div class='giscus'></div>";
          });
        };

        // Add plugin to docsify's plugin array
        $docsify = $docsify || {};
        $docsify.plugins = [].concat(
          contentPlugin,
          giscusPlugin,
          baiduTongjiPlugin,
          $docsify.plugins || []
        );
      })();
    </script>
    <script src="https://cdn.jsdelivr.net/npm/docsify/lib/docsify.min.js"></script>

    <!-- baiduTongJi -->
    <!-- <script src="https://cdn.jsdelivr.net/npm/docsify-baidu-tj/dist/docsify-baidu-tj.min.js"></script> -->
  </body>
</html>
